<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapScrap โ ุชูุฒูู ูุฑูุน Stories</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="bg-grid"></div>
    <div class="app-layout">
        <aside class="app-sidebar">
            <header class="sidebar-header">
                <div class="logo-row-small">
                    <i class="fa-brands fa-snapchat logo-snapchat-small fa-2x"></i>
                    <h2>SnapScrap</h2>
                </div>
    </div>

    <div class="sidebar-content">
        <div class="sidebar-section">
            <h3>ุงูุญุณุงุจุงุช ุงููุถุงูุฉ</h3>
            <div class="accounts-actions-sidebar">
                <button type="button" id="selectAll" class="btn-link-sm">ุงููู</button>
                <button type="button" id="deselectAll" class="btn-link-sm">ูุง ุฃุญุฏ</button>
            </div>
            <div class="accounts-list sidebar-list" id="accountsList">
                {% for a in accounts %}
                <label class="account-item-sidebar">
                    <input type="checkbox" class="account-check" data-username="{{ a.username }}" {% if a.checked
                        %}checked{% endif %}>
                    <span class="account-name">{{ a.username }}</span>
                    <button type="button" class="btn-remove-sm" data-username="{{ a.username }}" title="ุญุฐู">ร</button>
                </label>
                {% endfor %}
                <p class="empty-accounts" id="emptyAccounts" style="display:none">ูุง ุชูุฌุฏ ุญุณุงุจุงุช</p>
            </div>
        </div>

        <div class="sidebar-footer">
            <label class="toggle sidebar-toggle-item">
                <input type="checkbox" id="batchMergeSidebar">
                <span>ุฏูุฌ ุชููุงุฆู</span>
            </label>
            <button type="button" id="downloadSelected" class="btn btn-primary btn-block">
                ุชูุฒูู ุงููุญุฏุฏ
            </button>
        </div>
    </div>
    </aside>

    <main class="app-content">
        <header class="mobile-header" style="display:none;">
            <div class="logo-row">
                <h1>SnapScrap</h1>
            </div>
        </header>

        <!-- Stripe Upgrade Banner -->
        {% if current_user.subscription_tier == 'free' %}
        <div class="upgrade-banner"
            style="background: linear-gradient(135deg, #8b5cf6, #d946ef); padding: 18px 24px; border-radius: 16px; margin-bottom: 24px; color: white; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 25px rgba(217, 70, 239, 0.2);">
            <div>
                <h3 style="margin:0 0 5px 0; font-size:1.1rem; display:flex; align-items:center; gap:8px;">
                    <i class="fa-solid fa-crown" style="color: #fbbf24;"></i> ุงูุจุงูุฉ ุงููุฌุงููุฉ
                </h3>
                <p style="margin:0; font-size:0.9rem; opacity:0.9;">ุฃูุช ุญุงููุงู ุชุณุชุฎุฏู ุงูุจุงูุฉ ุงููุฌุงููุฉ ุจุญุฏ ุฃูุตู (2)
                    ุญุณุงุจุงุช. ูููุตูู ูุนุฏุฏ ุฃูุจุฑ ูุฌุฏููุฉ ุฃุณุฑุน ูุฌูุด APIุ ูู ุจุงูุชุฑููุฉ ููู Pro.</p>
            </div>
            <button onclick="checkoutStripe('pro')"
                style="background: white; color: #8b5cf6; border: none; padding: 10px 24px; border-radius: 10px; cursor: pointer; font-weight: 700; font-family: 'Tajawal', sans-serif; transition: transform 0.2s;">
                ุชุฑููุฉ ุฅูู Pro
            </button>
        </div>
        <script>
            function checkoutStripe(tier) {
                fetch('/api/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tier: tier })
                }).then(res => res.json()).then(data => {
                    if (data.checkout_url) window.location.href = data.checkout_url;
                    else alert(data.error);
                }).catch(console.error);
            }
        </script>
        {% endif %}

        <!-- Add Accounts -->
        <section class="card accounts-card">
            <div class="card-header">
                <div class="header-icons">
                    <span class="icon">โ</span>
                    <h2>ุฅุถุงูุฉ ุญุณุงุจุงุช</h2>
                </div>
            </div>
            <form id="addAccountForm" class="form-add-accounts">
                <div class="input-row">
                    <input type="text" id="newAccountInput" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู (ูุซุงู: dary_1256)">
                </div>
                <textarea id="newAccounts" placeholder="ุฃู ุฃุถู ุญุณุงุจุงุช ูุชุนุฏุฏุฉ (ูู ุญุณุงุจ ูู ุณุทุฑ)" rows="3"
                    style="display:none"></textarea>

                <div class="add-actions-row">
                    <button type="submit" id="submitAddBtn" class="btn btn-secondary">ุฅุถุงูุฉ</button>
                    <button type="button" id="toggleBulkAdd" class="btn-link">ุฅุถุงูุฉ ุฌููุฉ / ุญุณุงุจ ูุงุญุฏ</button>
                </div>
            </form>

            <div class="suggested-section">
                <div class="suggested-header" id="suggestedHeader" style="cursor: pointer;">
                    <span id="suggestedToggleIcon">โผ</span>
                    <span>ุญุณุงุจุงุช ููุชุฑุญุฉ</span>
                    <button type="button" id="refreshSuggested" class="btn-link btn-refresh" title="ุชุญุฏูุซ"
                        style="margin-right: auto;">โป</button>
                </div>
                <div class="suggested-list" id="suggestedList"></div>
                <button type="button" id="addSelectedSuggested" class="btn btn-secondary btn-sm">ุฅุถุงูุฉ
                    ุงููุญุฏุฏ</button>
            </div>
        </section>

        <!-- Quick Download -->
        <section class="card download-card">
            <div class="card-header">
                <h2>ุชูุฒูู ุณุฑูุน</h2>
                <p>ุฏูู ุฅุถุงูุฉ ูููุงุฆูุฉ</p>
            </div>
            <form id="downloadForm" class="form">
                <div class="input-group">
                    <input type="text" id="username" placeholder="ุงุณู ุงููุณุชุฎุฏู">
                    <label class="toggle">
                        <input type="checkbox" id="mergeAfter">
                        <span>ุฏูุฌ ุจุนุฏ ุงูุชุญููู</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-secondary">ุชูุฒูู</button>
            </form>
        </section>

        <!-- Merge -->
        <section class="card merge-card">
            <div class="card-header">
                <h2>ุฏูุฌ ุงูููุฏูููุงุช</h2>
            </div>
            <form id="mergeForm" class="form">
                <div class="input-row">
                    <input type="text" id="mergeUsername" placeholder="ุงุณู ุงููุณุชุฎุฏู">
                    <input type="date" id="mergeDate">
                </div>
                <div class="merge-mode" style="display:none;">
                    <label class="radio"><input type="radio" name="mergeMode" value="shorts" checked> Shorts</label>
                </div>
                <button type="submit" class="btn btn-secondary">ุฏูุฌ</button>
            </form>
        </section>

        <!-- Schedule -->
        <section class="card schedule-card">
            <div class="card-header">
                <div class="header-icons">
                    <span class="icon">โฐ</span>
                    <h2>ุฌุฏููุฉ</h2>
                </div>
            </div>
            <form id="scheduleForm" class="form">
                <label class="toggle big">
                    <input type="checkbox" id="scheduleEnabled" {% if schedule.enabled %}checked{% endif %}>
                    <span>ุชูุนูู ุงูุฌุฏููุฉ ุงูููููุฉ</span>
                </label>
                <div class="schedule-time">
                    <input type="number" id="scheduleHour" min="0" max="23" value="{{ schedule.get('hour', 9) }}">
                    <span>:</span>
                    <input type="number" id="scheduleMinute" min="0" max="59" value="{{ schedule.get('minute', 0) }}">
                </div>
                <p class="next-run" id="nextRun"></p>
                <label class="toggle">
                    <input type="checkbox" id="scheduleMerge" {% if schedule.merge %}checked{% endif %}>
                    <span>ุฏูุฌ ุชููุงุฆู</span>
                </label>
                <button type="submit" class="btn btn-secondary">ุญูุธ</button>
            </form>
        </section>

        <!-- Upload -->
        <section class="card upload-card highlight">
            <div class="card-header">
                <div class="header-icons">
                    <span class="icon icon-yt">โถ</span>
                    <h2>YouTube Upload</h2>
                </div>
            </div>
            <div class="upload-tabs">
                <button type="button" class="tab active" data-tab="folder">ูุฌูุฏ</button>
                <button type="button" class="tab" data-tab="file">ููู</button>
            </div>
            <div id="uploadFolder" class="tab-content active">
                <div class="refresh-row channels-row">
                    <button type="button" id="refreshMerged" class="btn-link btn-refresh">โป ูุฌูุฏุงุช</button>
                    <span>|</span>
                    <button type="button" id="refreshChannels" class="btn-link btn-refresh">โป ูููุงุช</button>
                    <a href="/youtube/connect" id="addChannel" class="btn-link">+ ููุงุฉ</a>
                </div>
                <div class="channel-select-row">
                    <select id="uploadChannel">
                        <option value="">ุงุฎุชุฑ ุงูููุงุฉ</option>
                    </select>
                </div>
                <p class="youtube-channels" id="youtubeChannels"></p>
                <form id="uploadForm" class="form">
                    <div class="input-row">
                        <select id="uploadUsername">
                            <option value="">ุงุฎุชุฑ ุงููุฌูุฏ</option>
                            <option value="__manual__">ูุฏูู</option>
                            {% for f in merged_folders %}
                            <option value="{{ f.username }}" data-date="{{ f.date }}">{{ f.username }} / {{ f.date
                                }}</option>
                            {% endfor %}
                        </select>
                        <div id="manualUpload" class="manual-row" style="display:none">
                            <input type="text" id="uploadUsernameManual" placeholder="User">
                            <input type="text" id="uploadDateManual" placeholder="Date">
                        </div>
                        <input type="hidden" id="uploadDate">
                        <select id="uploadPrivacy">
                            <option value="private">ุฎุงุต</option>
                            <option value="unlisted">ุบูุฑ ูุฏุฑุฌ</option>
                            <option value="public">ุนุงู</option>
                        </select>
                        <select id="uploadType" style="display:none;">
                            <option value="shorts" selected>Shorts</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-accent">ุฑูุน ุงููุญุฏุฏ</button>
                </form>
            </div>
            <div id="uploadFile" class="tab-content">
                <form id="uploadFileForm" class="form">
                    <div class="file-drop" id="fileDrop">
                        <input type="file" id="videoFile" accept="video/*" hidden>
                        <p class="file-drop-text">ุงุณุญุจ ููู ููุง</p>
                        <p class="file-selected" id="fileSelected" style="display:none"></p>
                    </div>
                    <input type="text" id="uploadTitle" placeholder="ุงูุนููุงู">
                    <select id="uploadFileChannel">
                        <option value="">ุงุฎุชุฑ ุงูููุงุฉ</option>
                    </select>
                    <select id="uploadFilePrivacy">
                        <option value="private">ุฎุงุต</option>
                        <option value="unlisted">ุบูุฑ ูุฏุฑุฌ</option>
                        <option value="public">ุนุงู</option>
                    </select>
                    <button type="submit" class="btn btn-accent">ุฑูุน YouTube</button>
                </form>
            </div>
        </section>

        <!-- YouTube Bulk Upload Card -->
        <section class="card bulk-card highlight">
            <div class="card-header">
                <div class="header-icons">
                    <span class="icon icon-yt">โถ</span>
                    <h2>ุฑูุน ุงููู (Bulk Upload)</h2>
                </div>
                <p>ุฑูุน ุฌููุน ุงููุฌูุฏุงุช ุงูุฌุงูุฒุฉ ูุชูุฒูุนูุง ุนูู ุงููููุงุช</p>
            </div>
            <div class="form">
                <div class="input-row">
                    <select id="bulkUploadChannel">
                        <option value="">ุงุฎุชุฑ ุงูููุงุฉ (ููู: ุงุฎุชุฑ Content Creators Stories)</option>
                    </select>
                </div>
                <button type="button" id="uploadAll" class="btn btn-primary"
                    style="background-color: var(--yt-red); color: white;">ุจุฏุก ุงูุฑูุน ุงูุดุงูู</button>
            </div>
        </section>

        <!-- Army of APIs Manager -->
        <section class="card army-card">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 10px;">
                <div class="header-icons">
                    <span class="icon" style="color: #fffc00;">๐ก๏ธ</span>
                    <h2>ุฅุฏุงุฑุฉ ุฌูุด ุงูููุงุชูุญ</h2>
                </div>
                <p style="font-size: 0.85rem; color: #a0a0b0; margin:0;">
                    ูู ุชุชููู ุงูุฑููุนุงุช ุฃุจุฏุงู. ุฃุถู ููุงุชูุญ ุงุญุชูุงุทูุฉ (tokens) ููู ููุงุฉุ ูุณูููู ุงููุธุงู ุจุชุฏููุฑูุง ุชููุงุฆูุงู ุนูุฏ
                    ููุงุฐ ุงูุญุตุฉ (Quota 403).
                </p>
            </div>

            <div class="army-list" style="display: flex; flex-direction: column; gap: 15px; margin-top: 15px;">
                {% for channel in youtube_channels %}
                <div class="army-item"
                    style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5rem; color: #ff0000;"><i class="fa-brands fa-youtube"></i></span>
                        <div>
                            <strong style="display: block; font-size: 1rem;">{{ channel.title }}</strong>
                            <small style="color: #a0a0b0;">{{ channel.id }}</small>
                        </div>
                    </div>

                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="token-badge"
                            style="background: rgba(0, 230, 118, 0.1); color: #00E676; padding: 5px 12px; border-radius: 20px; font-weight: 700; font-size: 0.85rem; border: 1px solid rgba(0, 230, 118, 0.3);">
                            <i class="fa-solid fa-key"></i> {{ channel.token_count }} ููุงุชูุญ ุงุญุชูุงุทูุฉ
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm"
                            onclick="showTokenUpload('{{ channel.id }}')"
                            style="padding: 6px 12px; font-size: 0.85rem; border-radius: 8px;">
                            + ุฅุถุงูุฉ ููุชุงุญ
                        </button>
                    </div>
                </div>
                {% else %}
                <div style="text-align: center; color: #a0a0b0; padding: 20px;">
                    ูุง ุชูุฌุฏ ูููุงุช ููุชููุจ ูุฑุชุจุทุฉ ุจุนุฏ. ูู ุจุฅุถุงูุฉ ููุงุฉ ูู ูุงุฆูุฉ ุงูุฑูุน.
                </div>
                {% endfor %}
            </div>

            <form id="tokenUploadForm" style="display: none;" enctype="multipart/form-data">
                <input type="hidden" id="tokenChannelId" name="channel_id">
                <input type="file" id="tokenFileInput" name="token_file" accept=".json" onchange="submitTokenUpload()">
            </form>

            <script>
                function showTokenUpload(channelId) {
                    document.getElementById('tokenChannelId').value = channelId;
                    document.getElementById('tokenFileInput').click();
                }

                function submitTokenUpload() {
                    const fileInput = document.getElementById('tokenFileInput');
                    if (!fileInput.files.length) return;

                    const formData = new FormData();
                    formData.append('channel_id', document.getElementById('tokenChannelId').value);
                    formData.append('token_file', fileInput.files[0]);

                    fetch('/api/youtube/upload_token', {
                        method: 'POST',
                        body: formData
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.ok) {
                                alert('ุชูุช ุฅุถุงูุฉ ุงูุฌูุฏู (ุงูููุชุงุญ) ุงูุงุญุชูุงุทู ุจูุฌุงุญ! ๐ก๏ธ');
                                window.location.reload();
                            } else {
                                alert('ุฎุทุฃ: ' + (data.error || "ุชุฃูุฏ ูู ุงุฎุชูุงุฑ ููู token.json ุตุญูุญ"));
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฑูุน');
                        });
                }
            </script>
        </section>

        <!-- TikTok -->
        <section class="card tiktok-card">
            <div class="card-header">
                <div class="header-icons">
                    <span class="icon">๐ฑ</span>
                    <h2>TikTok Upload</h2>
                </div>
            </div>
            <div class="tiktok-content">
                <p class="tiktok-info">ูุณุงุนุฏ ุงูุฑูุน ุงููุฏูู (Manual Bridge)</p>
                <div class="form">
                    <div class="input-row">
                        <select id="tiktokFolder">
                            <option value="">ุงุฎุชุฑ ุงููุฌูุฏ</option>
                            {% for f in merged_folders %}
                            <option value="{{ f.username }}" data-date="{{ f.date }}">{{ f.username }} / {{ f.date
                                }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="manual-bridge-actions">
                        <div class="action-step">
                            <span class="step-num">1</span>
                            <button type="button" id="copyCaptionBtn" class="btn btn-secondary btn-sm btn-block">ูุณุฎ
                                ุงูุนููุงู</button>
                        </div>
                        <div class="action-step">
                            <span class="step-num">2</span>
                            <button type="button" id="openFolderBtn" class="btn btn-secondary btn-sm btn-block">ูุชุญ
                                ุงููุฌูุฏ</button>
                        </div>
                        <div class="action-step">
                            <span class="step-num">3</span>
                            <button type="button" class="btn btn-accent btn-sm btn-block"
                                onclick="window.open('https://www.tiktok.com/upload', '_blank')">ูุชุญ TikTok</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Clear batch -->
        <section class="card clear-card">
            <div class="card-header">
                <h2>ุชูุธูู</h2>
            </div>
            <div class="form">
                <div class="input-row">
                    <select id="clearFolder">
                        <option value="">ุงุฎุชุฑ ุงููุฌูุฏ</option>
                        {% for f in merged_folders %}
                        <option value="{{ f.username }}" data-date="{{ f.date }}">{{ f.username }} / {{ f.date }}
                        </option>
                        {% endfor %}
                    </select>
                    <button type="button" id="clearBatchBtn" class="btn btn-secondary">ุญุฐู</button>
                </div>
            </div>
        </section>

        <section class="status-section" id="statusSection">
            <div class="status-card" id="statusCard">
                <div class="status-icon" id="statusIcon">โ</div>
                <div class="status-text">
                    <strong id="statusTitle"></strong>
                    <span id="statusMessage"></span>
                </div>
            </div>
        </section>

        <footer>
            <p class="copyright">SnapScrap ยฉ 2026</p>
        </footer>
    </main>
    </div>

    <script>
        window.INIT_ACCOUNTS = {{ accounts | tojson }};
    </script>
    <script src="/static/app.js"></script>
</body>

</html>